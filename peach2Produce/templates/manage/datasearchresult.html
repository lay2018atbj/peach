{% extends 'manage/base.html' %}

{%block head%}
        <script src="/static/manage/js/jquery-1.8.3.min.js"></script>
        <script src="/static/manage/js/highstock-6.1.1/code/highstock.js"></script>
        <script src="/static/manage/js/highstock-6.1.1/code/modules/exporting.js"></script>
        <!--script src="/static/manage/js/highcharts-6.1.1/code/highcharts-zh_CN.js"></script> -->
        <script src="/static/manage/js/highstock-6.1.1/code/themes/dark-unica.js"></script>
{%endblock%}

{%block content%}

<div class="mws-panel grid_8" >
    <div class="mws-panel-header">
        <span class="mws-i-24 i-table-1">历史数据 {{reTime['startTime']}} - {{reTime['endTime']}}</span>
    </div>
    <div class="mws-panel-body">
        <div class="mws-panel-toolbar top clearfix">
            <ul>
                <li><a href="#" class="mws-ic-16 mws-ic-16 ic-edit" onclick="showPopup()">查询历史记录</a></li>
                <!--<li><a href="#" class="mws-ic-16 ic-cross" onclick="removeCheck()">删除</a></li>
                <li><a href="#" class="mws-ic-16 ic-edit"  onclick="updateCheck()">编辑</a></li>
                <li><a href="#" class="mws-ic-16 ic-arrow-refresh" onclick="window.location.reload()">刷新</a></li>-->
            </ul>
        </div>
        <div id="white_content_pop" class="white_content">
            <div class="mws-panel-header">
                <span class="mws-i-24 i-check">查找条件</span>
            </div>
            <div class="mws-panel-body">
                <form id="mws-validate" class="mws-form" action="{{url_for('ma_workshop_searchHistoryDatas')}}"
                      method="post">
                    <div id="mws-validate-error" class="mws-form-message error" style="display:none;"></div>
                    <div class="mws-form-inline">
                        <div class="mws-form-row">
                            <label>设备ID</label>
                            <div class="mws-form-item large">
                                <input type="text" name="devId" class="mws-textinput required" value="{{id}}"/>
                            </div>
                        </div>
                        <div class="mws-form-row">
                            <label>起始时间点</label>
                            <div class="mws-form-item large">
                                <input type="text" name="startTime" class="mws-textinput required"/>
                            </div>
                        </div>
                        <div class="mws-form-row">
                            <label>结束时间点</label>
                            <div class="mws-form-item large">
                                <input type="text" name="endTime" class="mws-textinput"/>
                            </div>
                        </div>

                        <div class="mws-button-row">
                            <input type="submit" class="mws-button green" value="查询"/>
                            <input type="button" class="mws-button orange" onclick="closePopup()" value="取消"/>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="mws-panel-content" style="min-height:550px" id="weldingchart">
        </div>

    </div>
</div>




{%endblock%}

{%block scripts%}

<script>

Highcharts.setOptions({
		global : {
				useUTC : false
		}
});
// Create the chart
chart = Highcharts.stockChart('weldingchart', {
		chart : {
			    type: 'spline'
		},
			rangeSelector: {
				buttons: [{
						count: 1,
						type: 'minute',
						text: '1M'
				}, {
						count: 5,
						type: 'minute',
						text: '5M'
				}, {
						type: 'all',
						text: 'All'
				}],
				inputEnabled: false,
				selected: 0
		},
		title : {
				text : "{{config['DEVICES'][id]['name']}} 的历史采集数据<br/>"
		},
		tooltip: {
				split: false
		},
		exporting: {
				enabled: false
		},
		xAxis: {
		    type: 'datetime',
		    tickPixelInterval: 150
	    },
	    legend: {
			align: 'left',
			verticalAlign: 'top',
			y: 20,
			floating: true,
			borderWidth: 0
		},

		yAxis: [{
			title: {
				text: '电压'
			},
		    plotLines:[{
                color:'white',           //线的颜色，定义为红色
                dashStyle:'longdashdot',     //默认值，这里定义为实线
                value: {{config['DEVICES'][id]['V_THRESHILD_MAX']}},               //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                width:2,
                label:{text:'电压上限', style:{color:'white'}}
            },{
                color:'white',           //线的颜色，定义为红色
                dashStyle:'longdashdot',     //默认值，这里定义为实线
                value: {{config['DEVICES'][id]['V_THRESHILD_MIN']}},               //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                width:2,
                label:{text:'电压下限', style:{color:'white'} }
            }],
            min: 0 ,
            max: 60 ,
            labels: {
			    format: '{value} V',
			    style: {
				    color: '#7cb5ec'
			    }
		    }
		}, {    // 第二个坐标轴，电流
			title: {
				text: '电流'
			},
			plotLines:[{
                color:'red',           //线的颜色，定义为红色
                dashStyle:'longdashdot',     //默认值，这里定义为实线
                value: {{config['DEVICES'][id]['I_THRESHILD_MAX']}},               //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                width:2,               //标示线的宽度，2px
                label:{
                    text:'电流上限',
                    style:{color:'red'}
                }
            },{
                color:'red',           //线的颜色，定义为红色
                dashStyle:'longdashdot',     //默认值，这里定义为实线
                value: {{config['DEVICES'][id]['I_THRESHILD_MIN']}},               //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                width:2,
                label:{text:'电流下限',style:{color:'red'} }
            }],
            min: 0,
            max: 200,
            labels: {
			    format: '{value} A',
			    style: {
				    color: '#f7a35c'
			    }
		    }
		    ,opposite: true
		},{
			title: {
				text: '温度'
			},
            max: 100 ,
            labels: {
			    format: '{value} °C',
			    style: {
				    color:'#90ed7d'
			    }
			},opposite: true
		}],
		series : [{
				name : '电压',
				data :  ({{ reData['v'] }}),
				yAxis : 0,
		        color : '#7cb5ec'
		},
		{
				name : '电流',
				data : ({{ reData['e'] }}),
				yAxis : 1,
		        color : '#f7a35c'
		},
		{
				name : '温度',
				data : ({{ reData['e'] }}),
				yAxis : 2,
		        color : '#90ed7d'
		}]
});

</script>
{%endblock %}